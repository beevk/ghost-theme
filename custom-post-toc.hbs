{{!-- Layout --}}
{{!< default}} {{#post}} {{!-- Class for <body> --}}
    {{#contentFor "special_body_class"}}is-article{{/contentFor}}

    <article class="post py-vmin8 relative">
        <header class="post-header godo-canvas">
            {{!-- [Title, Excerpt, Author, DateTime, Share]- partials/article/article-header.hbs --}}
            {{> "article/article-header"}}
        </header>

        {{!-- Article Body - partials/article/article-body.hbs --}}
        <section id="post-body" class="post-body godo-canvas mx-auto relative {{#match @custom.post_font "=" "
            font-serif"}}font-serif{{else}}font-sans{{/match}}">
            {{!-- Post Image - partials/article/article-featured-image.hbs --}}
            {{#if feature_image}}{{> "article/article-featured-image" image=feature_image}}{{/if}}


            {{content}}

            {{!-- Table of Content - on the left --}}
            <div class="godo-content-side top-0 bottom-0 absolute pr-8 row-start-1 hidden font-sans lg:block">
                <div class="sticky top-20 overflow-auto scroll-transparent lg:max-h-(screen-16)">
                    <div class="uppercase font-medium text-sm mb-3">{{t "On this page"}}</div>
                    <div class="js-tocbot text-base space-y-4 leading-tight"></div>
                </div>
            </div>

            {{!-- Share and Tags buttons - on the right --}}
            <div class="content-right-side top-0 bottom-0 absolute pl-8 row-start-1 hidden font-sans lg:block">
                <div class="sticky top-20 overflow-auto scroll-transparent lg:max-h-(screen-16)">
                    <div class="uppercase font-medium text-sm mb-3">
                        <div class="uppercase font-medium text-sm mb-3">Tags</div>
                        <div class="space-y-4">
                            {{> "components/tags"}}
                        </div>
                    </div>
                    <div class="flex flex-col items-start">
                        <div class="uppercase font-medium text-sm mb-3">{{t "Share"}}</div>
                        {{!-- maybe replace with multiple social share icons --}}
                        {{> "components/social-share-vertical" Tracking_name="Footer"}}
                    </div>
                </div>
            </div>
        </section>

        <footer class="post-footer godo-canvas pt-10">
            {{!-- Tags - ./partials/components/tags,hbs --}}
            {{> "components/tags"}}

            {{!-- Social Share - ./partials/components/social-share --}}
            {{> "components/social-share" Tracking_name="Footer"}}

            {{!-- Newsletter - ./partials/components/newsletter.hbs --}}
            {{> "components/newsletter"}}

            {{!-- Previous and next article --}}
            <div class="prev-next pb-8">
                <hr class="my-10">
                {{#prev_post}}
                {{> "story/story-previous-next" storyTitle=(t "Previous article") class="mb-8"}}
                {{/prev_post}}

                {{#next_post}}
                {{> "story/story-previous-next" storyTitle=(t "Next article") class=""}}
                {{/next_post}}
            </div>
        </footer>
    </article>

    {{/post}}

    {{!-- 6 Related Articles - partials/article/article-related.hbs --}}
    {{> "article/article-related"}}

    {{!-- Post Commets - partials/article/article-comments.hbd --}}
    {{#post}}{{> "article/article-comments"}}{{/post}}

    {{#contentFor "scripts"}}
    <script>
        function addTOC() {
            var $markdown = document.querySelector('.post-body');
            if (!$markdown) return;

            var $titles = $markdown.querySelectorAll('h2[id], h3[id]');

            if (!$titles.length) return;

            var $jsTocBot = document.querySelector('.js-tocbot');

            var lastH2Link = null; // Keep track of last H2 link to append H3 links under it

            $titles.forEach(function (el) {
                if (el.tagName.toLowerCase() === 'h2') {
                    var titleLink = document.createElement('a');
                    titleLink.href = '#' + el.getAttribute('id');
                    titleLink.textContent = el.textContent;
                    titleLink.classList = 'toc-item text-gray-500 block !no-underline hover:text-gray-900';
                    var listItem = document.createElement('li'); // Create a list item
                    listItem.appendChild(titleLink); // Append the link to the list item
                    listItem.style.listStyleType = 'none'; // Remove bullet points
                    $jsTocBot.appendChild(listItem); // Append the list item to the TOC container
                    lastH2Link = listItem; // Update last H2 link
                } else if (el.tagName.toLowerCase() === 'h3' && lastH2Link) {
                    var titleLink = document.createElement('a');
                    titleLink.href = '#' + el.getAttribute('id');
                    titleLink.textContent = el.textContent;
                    titleLink.classList = 'toc-item text-gray-500 block !no-underline hover:text-gray-900 pl-4'; // Add left indentation
                    lastH2Link.appendChild(titleLink); // Append H3 link under last H2 link
                }
            });
        };

        document.addEventListener('DOMContentLoaded', addTOC);
    </script>
    {{/contentFor}}